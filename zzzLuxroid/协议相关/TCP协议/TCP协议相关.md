tcp udp 区别

https://zhuanlan.zhihu.com/p/76023663

https://www.zhihu.com/question/24853633/answer/115173386

https://www.jianshu.com/p/62940de97ca5

https://www.cnblogs.com/syfwhu/p/5143437.html
https://zhuanlan.zhihu.com/p/135932018
https://www.cnblogs.com/coder-programming/p/10627746.html
https://cloud.tencent.com/developer/article/1857368
https://blog.csdn.net/z302766296/article/details/111318920
https://www.cnblogs.com/diegodu/p/4538897.html

TCP必需要解决的可靠传输以及包乱序（reordering）的问题
滑动窗口 -- 表征发送端和接收端的接收能力

TCP头里有一个字段叫Window，又叫Advertised-Window，这个字段是接收端告诉发送端自己还有多少缓冲区可以接收数据。于是发送端就可以根据这个接收端的处理能力来发送数据，而不会导致接收端处理不过来
123，3456，78,91
其中123是发送已被确认的包，3456是发送完未收到ack的包，78是是在窗口中还未发出的，91是窗口外的空间，接受方没有空间

拥塞窗口-- 表征中间设备的传输能力
特性：慢启动，三次握手，四次挥手，三次握手有1.5RTT（round-trip time）延迟
key:
拥塞控制的几种方式：
1.慢启动：在连接在一个较慢的网络链路上建立，如果一开始发送的数据太多，就会耗尽路由器的缓存空间，造成网络拥塞，每当有一个ack，拥塞窗口大小+1，没有一个RTT，拥塞窗口*2
2.拥塞避免：当慢启动的拥塞窗口大小指数级上升时，为了避免造成拥塞有一个限制叫慢启动门限(ssthresh)，当超过该值，进入拥塞避免，拥塞窗口不在呈指数级上升，开始加法增加，此时当窗口中所有的报文段都被确认时，cwnd的大小加1，cwnd的值就随着RTT开始线性增加，这样就可以避免增长过快导致网络拥塞，慢慢的增加调整到网络的最佳值
3.快速恢复:当TCP收到乱序的3个相同的ACK时，认为丢包(为什么)因为，TCP快速的发送数据包，当其中的一个丢了之后，这一个的后续几个虽然端已经收到，但是无法给发送端发送确认，这个时候发送端也会认为这些后续的包也一起丢失了也会一起发送后续的数据包，浪费资源，TCP有一个机制，累计确认机制，当接收端期望收到seq为2时，但是一直收到seq3，失序到达，此时，接收端会快速发送ACK2，当到达3次之后TCP会重传该数据包
4.超时重传
5.选择性应答
TCP通信时，如果发送序列中间某个数据包丢失，TCP会通过重传最后确认的包开始的后续包，这样原先已经正确传输的包也可能重复发送，急剧降低了TCP性能。为改善这种情况，发展出SACK(Selective Acknowledgment, 选择性确认)技术，使TCP只重新发送丢失的包，不用发送后续所有的包，而且提供相应机制使接收方能告诉发送方哪些数据丢失，哪些数据重发了，哪些数据已经提前收到等。SACK是TCP中的一个可选特性，要想启用需要自己打开设置。

TCP怎么发现进入拥塞：有丢包，拥塞后会把慢启动门限的大小设为拥塞窗口的一般，并且把拥塞窗口设为1，重新进入慢启动

TCP的几个概念：
拥塞窗口：（congestion window，CWND）

TCP是怎么保证数据传输的顺序，和有序性
TCP把每一个数据包添加序号，按照序号发送，并且发送后，会在缓冲区中缓冲当前发送的数据包，当收到回答之后，清除该数据包。否则重传该数据包

一、ACK定义
TCP协议中，接收方成功接收到数据后，会回复一个ACK数据包，表示已经确认接收到ACK确认号前面的所有数据。
ACK字段长度为32位，能表示0~2^32-1之间的值。

二、ACK作用
发送方在一定时间内没有收到服务端的ACK确认包后，就会重新发送TCP数据包。发送方收到了ACK，表明接收方已经接收到数据，保证了数据的可靠达到。

三、ACK机制
接收方在接收到数据后，不是立即会给发送方发送ACK的。这可能由以下原因导致：
1、收到数据包的序号前面还有需要接收的数据包。因为发送方发送数据时，并不是需要等上次发送数据被Ack就可以继续发送TCP包，而这些TCP数据包达到的顺序是不保证的，这样接收方可能先接收到后发送的TCP包（注意提交给应用层时是保证顺序的）。
2、为了降低网络流量，ACK有延迟确认机制。
3、ACK的值到达最大值后，又会从0开始。

四、ACK延迟确认机制
接收方在收到数据后，并不会立即回复ACK,而是延迟一定时间。一般ACK延迟发送的时间为200ms，但这个200ms并非收到数据后需要延迟的时间。系统有一个固定的定时器每隔200ms会来检查是否需要发送ACK包。这样做有两个目的。
1、这样做的目的是ACK是可以合并的，也就是指如果连续收到两个TCP包，并不一定需要ACK两次，只要回复最终的ACK就可以了，可以降低网络流量。
2、如果接收方有数据要发送，那么就会在发送数据的TCP数据包里，带上ACK信息。这样做，可以避免大量的ACK以一个单独的TCP包发送，减少了网络流量。


三次握手四次挥手

为什么需要三次握手
https://www.zhihu.com/question/24853633
这个问题的本质是, 信道不可靠, 但是通信双发需要就某个问题达成一致. 而要解决这个问题, 无论你在消息中包含什么信息, 三次通信是理论上的最小值. 所以三次握手不是TCP本身的要求, 而是为了满足"在不可靠信道上可靠地传输信息"这一需求所导致的.


粘包问题处理

https://zhuanlan.zhihu.com/p/387256713


三种方式
1.固定包长的数据包 不灵活 剩余空间怎么处理？
2.以指定字符（串）为包的结束标志  其不足之处就是如果协议数据包内容部分需要使用包结束标志字符，就需要对这些字符做转码或者转义操作，以免被接收方错误地当成包结束标志而误解析。
3.包头 + 包体格式
这种格式的包一般分为两部分，即包头和包体，包头是固定大小的，且包头中必须含有一个字段来说明接下来的包体有多大。
struct msg_header
{
    int32_t bodySize;
    int32_t cmd;
};